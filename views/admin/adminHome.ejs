<!DOCTYPE html>
<html lang="en">
   
<!-- Mirrored from freshcart.codescandy.com/dashboard/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 22 Mar 2024 09:07:54 GMT -->
<head>
      <!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="Codescandy" name="author">
      <title>Dashboard eCommerce HTML Template - FreshCart</title>
      <!-- Favicon icon-->
<link rel="shortcut icon" type="image/x-icon" href="../images/favicon/favicon.ico">


<!-- Libs CSS -->
<link href="../libs/bootstrap-icons/font/bootstrap-icons.min.css" rel="stylesheet">
<link href="../libs/feather-webfont/dist/feather-icons.css" rel="stylesheet">
<link href="../libs/simplebar/dist/simplebar.min.css" rel="stylesheet">


<!-- Theme CSS -->
<link rel="stylesheet" href="../css/theme.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M8S4MT3EYG"></script>
<script>
   window.dataLayer = window.dataLayer || [];
   function gtag() {
      dataLayer.push(arguments);
   }
   gtag("js", new Date());

   gtag("config", "G-M8S4MT3EYG");
</script>
 <script type="text/javascript">
   (function (c, l, a, r, i, t, y) {
      c[a] =
         c[a] ||
         function () {
            (c[a].q = c[a].q || []).push(arguments);
         };
      t = l.createElement(r);
      t.async = 1;
      t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0];
      y.parentNode.insertBefore(t, y);
   })(window, document, "clarity", "script", "kuc8w5o9nt");
</script>

   </head>

   <body>
      <!-- main -->
      <div>
         <!-- navbar -->
<nav class="navbar navbar-expand-lg navbar-glass">
	<div class="container-fluid">
		<div class="d-flex justify-content-between align-items-center w-100">
			<div class="d-flex align-items-center">
				<a class="text-inherit d-block d-xl-none me-4" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button" aria-controls="offcanvasExample">
					<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-text-indent-right" viewBox="0 0 16 16">
						<path
							d="M2 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm10.646 2.146a.5.5 0 0 1 .708.708L11.707 8l1.647 1.646a.5.5 0 0 1-.708.708l-2-2a.5.5 0 0 1 0-.708l2-2zM2 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"
						/>
					</svg>
				</a>

				<form role="search">
					<input class="form-control" type="search" placeholder="Search" aria-label="Search" />
				</form>
			</div>
			<div>
				<ul class="list-unstyled d-flex align-items-center mb-0 ms-5 ms-lg-0">
					<li class="dropdown ms-4">
						<a href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
							<img src="../images/avatar/avatar-1.jpg" alt="" class="avatar avatar-md rounded-circle" />
						</a>

						<div class="dropdown-menu dropdown-menu-end p-0">
							<div class="lh-1 px-5 py-4 border-bottom">
								<h5 class="mb-1 h6">Admin</h5>
								<small><%- admin %></small>
							</div>

							<div class="border-top px-5 py-3">
								<span id="logutBtn">Log Out</span>
							</div> 
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>
</nav>


         <div class="main-wrapper">
            <!-- navbar vertical -->
            <!-- navbar -->
<nav class="navbar-vertical-nav d-none d-xl-block">
	<div class="navbar-vertical">
		<div class="px-4 py-5">
			<a href="./adminHome" class="navbar-brand">
				<img src="../images/logo/freshcart-logo.svg" alt="" />
			</a>
		</div>
		<div class="navbar-vertical-content flex-grow-1" data-simplebar="">
			<ul class="navbar-nav flex-column" id="sideNavbar">
				<li class="nav-item">
					<a class="nav-link  active " href="/admin/adminHome">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-house"></i></span>
							<span class="nav-link-text">Dashboard</span>
						</div>
					</a>
				</li>
				<li class="nav-item mt-6 mb-3">
					<span class="nav-label">Store Managements</span>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="/admin/products">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-cart"></i></span>
							<span class="nav-link-text">Products</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="/admin/categories">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-list-task"></i></span>
							<span class="nav-link-text">Categories</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="/admin/order-list">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-bag"></i></span>
							<span class="nav-link-text">Orders</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="/admin/vendor">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-shop"></i></span>
							<span class="nav-link-text">Coupon</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="/admin/customers">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-people"></i></span>
							<span class="nav-link-text">Customers</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="/admin/banners">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-people"></i></span>
							<span class="nav-link-text">Banner Management</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/admin/promotion">
					  <div class="d-flex align-items-center">
						<span class="nav-link-icon"><i class="bi bi-people"></i></span>
						<span class="nav-link-text">Promotions</span>
					  </div>
					</a>
				  </li>
				<li class="nav-item">
					<a class="nav-link " href="/admin/reviews">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-star"></i></span>
							<span class="nav-link-text">Reviews</span>
						</div>
					</a>
				</li>

			</ul>
		</div>
	</div>
</nav>

<nav class="navbar-vertical-nav offcanvas offcanvas-start navbar-offcanvac" tabindex="-1" id="offcanvasExample">
	<div class="navbar-vertical">
		<div class="px-4 py-5 d-flex justify-content-between align-items-center">
			<a href="./adminHome.hbs" class="navbar-brand">
				<img src="../images/logo/freshcart-logo.svg" alt="" />
			</a>
			<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
		</div>
		<div class="navbar-vertical-content flex-grow-1" data-simplebar="">
			<ul class="navbar-nav flex-column">
				<li class="nav-item">
					<a class="nav-link  active " href="./adminHome">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-house"></i></span>
							<span>Dashboard</span>
						</div>
					</a>
				</li>
				<li class="nav-item mt-6 mb-3">
					<span class="nav-label">Store Managements</span>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="./products">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-cart"></i></span>
							<span class="nav-link-text">Products</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="./categories">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-list-task"></i></span>
							<span class="nav-link-text">Categories</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="/admin/order-list">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-bag"></i></span>
							<span class="nav-link-text">Orders</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="./vendor">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-shop"></i></span>
							<span class="nav-link-text">Coupon</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="./customers">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-people"></i></span>
							<span class="nav-link-text">Customers</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="/admin/banners">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-people"></i></span>
							<span class="nav-link-text">Banner Management</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/admin/promotion">
					  <div class="d-flex align-items-center">
						<span class="nav-link-icon"><i class="bi bi-people"></i></span>
						<span class="nav-link-text">Promotions</span>
					  </div>
					</a>
				  </li>
				<li class="nav-item">
					<a class="nav-link " href="./reviews">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-star"></i></span>
							<span class="nav-link-text">Reviews</span>
						</div>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link " href="./sales-report">
						<div class="d-flex align-items-center">
							<span class="nav-link-icon"><i class="bi bi-star"></i></span>
							<span class="nav-link-text">Sales Report</span>
						</div>
					</a>
				</li>
			</ul>
		</div>
	</div>
</nav>

            <!-- main wrapper -->
            <main class="main-content-wrapper">
               <section class="container">
                  <!-- row -->
                  <div class="row mb-8">
                     <div class="col-md-12">
                        <!-- card -->
                        <div
                           class="card bg-light border-0 rounded-4"
                           style="background-image: url(../images/slider/slider-image-1.jpg); background-repeat: no-repeat; background-size: cover; background-position: right">
                           <div class="card-body p-lg-12">
                              <h1>Welcome back! FreshCart</h1>
                              <p>FreshCart is simple & clean design for developer and designer.</p>
                              <a href="./add-product" class="btn btn-primary">Create Product</a>
                           </div>
                        </div>
                     </div>
                  </div>
                  <!-- table -->
                  <div class="table-responsive-xl mb-6 mb-lg-0">
                     <div class="row flex-nowrap pb-3 pb-lg-0">
                        <div class="col-lg-4 col-12 mb-6">
                           <!-- card -->
                           <div class="card h-100 card-lg">
                              <!-- card body -->
                              <div class="card-body p-6">
                                 <!-- heading -->
                                 <div class="d-flex justify-content-between align-items-center mb-6">
                                    <div>
                                       <h4 class="mb-0 fs-5">Earnings</h4>
                                    </div>
                                    <div class="icon-shape icon-md bg-light-danger text-dark-danger rounded-circle">
                                       <i class="bi bi-currency-dollar fs-5"></i>
                                    </div>
                                 </div>
                                 <!-- project number -->
                                 <div class="lh-1">
                                    <h1 class="mb-2 fw-bold fs-2"><%- totalEarnings[0] && totalEarnings[0].total ? totalEarnings[0].total : 0 %></h1>
                                    
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-lg-4 col-12 mb-6">
                           <!-- card -->
                           <div class="card h-100 card-lg">
                              <!-- card body -->
                              <div class="card-body p-6">
                                 <!-- heading -->
                                 <div class="d-flex justify-content-between align-items-center mb-6">
                                    <div>
                                       <h4 class="mb-0 fs-5">Orders</h4>
                                    </div>
                                    <div class="icon-shape icon-md bg-light-warning text-dark-warning rounded-circle">
                                       <i class="bi bi-cart fs-5"></i>
                                    </div>
                                 </div>
                                 <!-- project number -->
                                 <div class="lh-1">
                                    <h1 class="mb-2 fw-bold fs-2"><%- total_orders %></h1>
                                   
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-lg-4 col-12 mb-6">
                           <!-- card -->
                           <div class="card h-100 card-lg">
                              <!-- card body -->
                              <div class="card-body p-6">
                                 <!-- heading -->
                                 <div class="d-flex justify-content-between align-items-center mb-6">
                                    <div>
                                       <h4 class="mb-0 fs-5">Customer</h4>
                                    </div>
                                    <div class="icon-shape icon-md bg-light-info text-dark-info rounded-circle">
                                       <i class="bi bi-people fs-5"></i>
                                    </div>
                                 </div>
                                 <!-- project number -->
                                 <div class="lh-1">
                                    <h1 class="mb-2 fw-bold fs-2"><%- total_user %></h1>
                                    
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>

                  <!-- row -->
                  <div class="row">
                     <div class="col-xl-8 col-lg-6 col-md-12 col-12 mb-6">
                        <!-- card -->
						<div>
							<canvas id="myChart"></canvas>
							<select id="month">
								<option value="months" selected>Months</option>
								<option value="01">Jan</option>
								<option value="02">Feb</option>
								<option value="03">Mar</option>
								<option value="04">Apr</option>
								<option value="05">May</option>
								<option value="06">Jun</option>
								<option value="07">Jul</option>
								<option value="08">Aug</option>
								<option value="09">Sep</option>
								<option value="10">Oct</option>
								<option value="11">Nov</option>
								<option value="12">Dec</option>
							</select>
							<input id="year" placeholder="YYYY">
							<button id="date">Filter</button>
						  </div>


                     </div>
                     
                  </div>
                  <!-- row -->
                  
                  <!-- row -->
                  <div class="row">
                     <div class="col-xl-6 col-lg-6 col-md-6 col-12 mb-6">
                        <div class="card h-100 card-lg">
                           <!-- heading -->
                           <div class="p-6">
                              <h3 class="mb-0 fs-5">Best Selling Categories</h3>
                           </div>
                           <div class="card-body p-0">
                              <!-- table -->
                              <div class="table-responsive">
                                 <table class="table table-centered table-borderless text-nowrap table-hover">
                                    <thead class="bg-light">
                                       <tr>
                                          <th scope="col">No.</th>
                                          <th scope="col">Category Name</th>
                                          <th scope="col">Purchased</th>
                                          <th scope="col">Revenue</th>
                                       </tr>
                                    </thead>
                                    <tbody>
										<% topSellingCategories.forEach((category,index) => { %>
                                       <tr>
										   <td>#<%- index + 1 %></td>
                                          <td><%- category._id %></td>
                                          <td><%- category.totalQuantity %></td>
										  <% let revenue = category.totalPrice.toFixed(2) %>
                                          <td><%- revenue %></td>
										</tr>
										<% }) %>
                                    </tbody>
                                 </table>
                              </div>
                           </div>
                        </div>
                     </div>

					 <!-- BEST SELLING PRODUCTS -->

                     <div class="col-xl-6 col-lg-6 col-md-6 col-12 mb-6">
                        <div class="card h-100 card-lg">
                           <!-- heading -->
                           <div class="p-6">
                              <h3 class="mb-0 fs-5">Top Selling Products</h3>
                           </div>
                           <div class="card-body p-0">
                              <!-- table -->
                              <div class="table-responsive">
                                 <table class="table table-centered table-borderless text-nowrap table-hover">
                                    <thead class="bg-light">
                                       <tr>
                                          <th scope="col">Product Name</th>
                                          <th scope="col">Purchased</th>
                                          <th scope="col">Revenue</th>
                                       </tr>
                                    </thead>
                                    <tbody>
										<% bestSellingProducts.forEach(product => { %>
											
                                       <tr>
										   <td><%- product.productDetails.productName %></td>
										   <td><%- product.totalQuantity %></td>
										  <% let revenue = product.totalPrice.toFixed(2) %>
                                          <td><%- revenue %></td>
										</tr>
										
										<% }) %>
                                    </tbody>
                                 </table>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </section>
            </main>
         </div>
      </div>

    <!-- Libs JS -->
	  	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script src="../libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
		<script src="../libs/simplebar/dist/simplebar.min.js"></script>

	<!-- Theme JS -->
		<script src="../js/theme.min.js"></script>
      	<script src="../libs/apexcharts/dist/apexcharts.min.js"></script>
      	<script src="../js/vendors/chart.js"></script>




		  <script>
			document.getElementById('logutBtn').addEventListener('click' , async(e)=>{
				e.preventDefault()
				const response = await fetch('/admin/adminLogout',{
					method : 'POST',
				})
				const data = await response.json()
				if(!response.ok){
					throw new Error('Failed to logout')
				}else{
					window.location.href = data.redirect
				}
			})
			let myChartInstance = null;
		  
			window.addEventListener('load', async () => {   
			  const response = await fetch('/admin/adminHome', {
				method: 'post'
			  });
			  
			  if (!response.ok) {
				throw new Error('something went wrong while fetching order details');
			  }
			  
			  const data = await response.json();
			  const ctx = document.getElementById('myChart').getContext('2d');
			  
			  myChartInstance = new Chart(ctx, {
				type: 'bar',
				data: {
				  labels: data.labels,
				  datasets: [{
					label: 'Sales Amount',
					data: data.data,
					borderWidth: 1
				  }]
				},
				options: {
				  scales: {
					y: {
					  beginAtZero: true
					}
				  }
				}
			  });
			});
		  
			const filter = document.querySelector('#date');
		  
			filter.addEventListener('click', async () => {
			  const month = document.querySelector('#month').value;
			  const year = document.querySelector('#year').value;
			  
			  const response = await fetch('/admin/adminHome', {
				method: 'post',
				headers: {
				  'Content-Type': 'application/json'
				},
				body: JSON.stringify({ month, year })
			  });
		  
			  if (!response.ok) {
				throw new Error('something went wrong while fetching filtered order details');
			  }
		  
			  const data = await response.json();
		  
			  if (myChartInstance) {
				myChartInstance.destroy(); // destroy existing chart instance
			  }
		  
			  const ctx = document.getElementById('myChart').getContext('2d');
		  
			  myChartInstance = new Chart(ctx, {
				type: 'bar',
				data: {
				  labels: data.labels,
				  datasets: [{
					label: 'Sales Amount',
					data: data.data,
					borderWidth: 1
				  }]
				},
				options: {
				  scales: {
					y: {
					  beginAtZero: true
					}
				  }
				}
			  });
			});
		  </script>
   </body>
</html>
